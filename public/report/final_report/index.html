<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/website/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=website/livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Development of A Battery Management System for AUV4.5 | AUV Battery Management System</title>
<meta name="keywords" content="">
<meta name="description" content="This report documents the work done on developing the Battery Management System for an Autonomous Underwater Vehicle (AUV4.5) in preparation for RoboSub 2025.">
<meta name="author" content="Teoh Xu En">
<link rel="canonical" href="http://localhost:1313/website/report/final_report/">
<link crossorigin="anonymous" href="/website/assets/css/stylesheet.d6cf4a8fa527330d9574f36d8d000fdaf90ca838ff09ab72fc27d3cb7ca1ddc5.css" integrity="sha256-1s9Kj6UnMw2VdPNtjQAP2vkMqDj/Caty/CfTy3yh3cU=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/website/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/website/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/website/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/website/apple-touch-icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/website/report/final_report/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Development of A Battery Management System for AUV4.5" />
<meta property="og:description" content="This report documents the work done on developing the Battery Management System for an Autonomous Underwater Vehicle (AUV4.5) in preparation for RoboSub 2025." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/website/report/final_report/" /><meta property="article:section" content="report" />
<meta property="article:published_time" content="2025-04-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2025-04-04T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Development of A Battery Management System for AUV4.5"/>
<meta name="twitter:description" content="This report documents the work done on developing the Battery Management System for an Autonomous Underwater Vehicle (AUV4.5) in preparation for RoboSub 2025."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Report",
      "item": "http://localhost:1313/website/report/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Development of A Battery Management System for AUV4.5",
      "item": "http://localhost:1313/website/report/final_report/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Development of A Battery Management System for AUV4.5",
  "name": "Development of A Battery Management System for AUV4.5",
  "description": "This report documents the work done on developing the Battery Management System for an Autonomous Underwater Vehicle (AUV4.5) in preparation for RoboSub 2025.",
  "keywords": [
    
  ],
  "articleBody": "Acknowledgement Bumblebee Team, especially Elec Team to bounce idea with Zi Yang and Tan Chern Lin for providing feedback, Chen Jia Wei for troubleshooting. Marvin for giving the idea. Guk Yi Siong for helping in obtaining power consumption data Ananyan for validating my mechanical ideas Ms Annie, Patrick, KK, Graham Parker Schless from Cornell AUV for his advice when I faced problems Eugene for taking time to review the project and providing advice School for providing the lab, lab equipment and resources sponsors for helping the team also List of Common Acronyms TODO:\nSummary TODO:\nProblem Background Introduction\nStudent Project TEam that develops AUV for RoboSub. Previously sent AUV4.1 for RoboSub 2024 and is developing AUV4.5 for RoboSub 2025 and AUV 5.0 for RoboSub 2025 Insert Table and timeline of the different AUV Problem Context\nBackground\nBattery Management System comprises of Battery Hull -\u003e PMB, Battery and Battery Hull Battery Charging Box -\u003e Charger Designed such that the batteries are in its own waterproof hull so that it is easy to change battery at pool test BCB is designed to support the current system by adapting the connectors to the charger PMB is used to turn on and off the batter and report its voltage and current on the CAN Bus. Current Challenges\nDifficult to seal Increase down time Bad user operation Limited Capabilities of Battery Fuel Gauge Poor Fuel Guaging (lack there off) Reduce Run time No Protection (It just monitors the voltage and current) Reduce Reliability No systematic monitoring of leak Poor User Operation Unreliable Analysis of Problems\nBad user operation -\u003e prone to mistakes at competition can cause reliability issue at competition Increase down time and Reduce run time -\u003e less testing can be done Give example of current situation only 1 set of functional battery -\u003e means test for 1h45 mins 1255 to 1415 Charging -\u003e 1h20mins of charging Increase run time huge priority Table of Testing Time -\u003e compared to RobotX Result (get from interim presentation) Project Goal As a competition team, the primary objective of our vehicle is to perform well at its competition (RoboSub). This can be attained by reducing the vehicle’s down time and ensuring a safe, systematic operations\nRefer to the Analysis of Problem\nProject Goal: To develop a battery management systems that improves runtime, user operability and safety to enhance the AUV’s reliability and performance.\nDesign Considerations Design Specification Need to fit in the same hull (Backward Compatibility) PMB size constraints Have to use the same connector and pins Becasue we deploying AUV4.5 Minimal modification allow for easy swap (get to work with new and old PMB) Streamline spare prep and lower cost by leveraging Economies of Scale Basic Criteria (can be presented in a table) Able to power 40A continuous Can spike X A Able to communicate with rest of AUV Same Interface Reed Switch to turn on and off Able to display key stats on screen Ease of Production and Spares (competition experience) Less stuff to pack MCU, CAN Chip etc are standardised. System Design Provide a bigger picture first. Summary of the system design, will go into details below how everything work etc. (how the design of the PMB and BCB PCB can help to fulfil the project goal while meeting design considerations)\n2x PMB Architecture -\u003e surrounded by dotted lines\nArchitecture should reference the PMB along with the different subsystem and external components Talk about the differnt Power and Grounds One is when connected in BCB Show how the power goes to charger CAN goes to PMB board PMB board powerd by USB-C Using Balance connector for programming pin Data Flow PMB -\u003e CAN Bus -\u003e ESP32 -\u003e Telegram Bot -\u003e Google App Script One is when connected to AUV Show that it communicate with CAN to AUV Power with connector Data Flow PMB -\u003e CAN Bus -\u003e SBC-CAN -\u003e Serial -\u003e SBC -\u003e Ethernet to Router -\u003e Data Uploaded Online Using SystemPres, Relay and Reed Switch to turn on the vehicle\nTurn on is via reed switch activiating a relay Turn off is MCU detect reed switch and activate a signal Allows MCU to do whatever it needds to do before pwoering off. Increase Run Time Insert description on why we want to increase run time and how to do it\nBattery Upgrade\nCurrent Battery is 2 years old where with regular discharge Insert data on battery degradation over time We need 6 batteries for each AUV especially with the 2x AUV Need procure new cost effective batteries Shortlisted 3x Batteries Same Voltage and Dimensions to fit in the hull and to be backward compatible Power per dollar comparison Li-Ion chosen for the higher capacity ina smaller form factor Purchase 2x Raitan Battery for test Insert table to compare the 2x battery runtime as well as dimensions comparison with weight 2.4kg for 2 LiIon Battery, 2.5kg for 2 LiPo battery Old: 188 x 75 x 42, New: 171 x 78 x 44 Insert photo of the battery in the hull Compare Power Drain between old and new battery Shown that the Raitan battery is a worthy replacement The Molicell Chemistry is available by TI -\u003e help make the learning process easier (check if the other chemistry have or not) Accurate SoC Estimation\nPreviously was using the gauging chip without using the learning algorithm Means rely on voltage only Inaccurate -\u003e insert voltage to capacity graph to explain why is it difficult to stop based on voltage By changing the chip we can implement RSOC tracking Allow us to stop at a more accurate time More time to draw Say we do research found 2 other teams with battery gauging OSU and Cornell -\u003e one is using BQ40Z50 the other is using BQ40Z80 (double check the name) Showed that it is utilised by teams with good results Insert replies by Cornell on good review Standalone with protection, gauging feaure Software to allow for easy configuration of data flash and registers Insert Photo of BQ Studio Interface Lots of support from TI (forum) Maybe can put a literature review portion to explain how the Impedance Tracking work and how the learning process works Chose BQ40Z50 as it has a more accurate tracking Insert comparison table with older chip Able to support 4S Lots of support online Based on battery chemistry + learning to study Insert power draw time difference If using RSOC give us extra 20mins as compared to if we relied on voltage only Look at their predicted charging and draw time, then compare how accurate it is Charging (Case 1) 8:20pm, predcited 70 minutes. Battery: 16.42V RSOC 84%, charging at 4A completed at 9.10pm. Battery: 16.84V, RSOC 100%. Finished 20mins faster than expected Charging (Case 2) 1.07 AM, 128 Minutes left, battery at 65% and 15.76 V 2.41 AM, charging completed. Finished 30mins faster than expected Improve User Operability and Workflow Aim to make it easier for memerbs to oeprate and maintain vehicle to keep vehcile reliable despite long operation hours. Main goal is to reduce down time but icnreasing reliability. Help to prevent damage to battery hulls or vehicle. Prevent taking people away from development by fixing damges.\nIn-Hull Firmware Flashing\nAllows for flashing and update without opening hull Reduces error during reseasling, reduces downtime Tested during RobotX 2024 where a USB port was exposed on the ASV to allow for firmware flashing Few Option CAN Bus Flashing to allow for flashing via CAN Require higher overhead as you need a more expensive microcontroller Need build own bootloader Show old connector where CAN is alreaday exposed Use the original Balance Connector Explain that with the BQ40Z50 chip, balancing can be done with the chip, so balancing dont have to use charger to balance. Frees up the connector Reduce changes needed to be done Allows to expose the BQ chip comms also Insert image of old balance connector vs new balance connector Remote Status Monitoring\nAS mentioned in xxx manual logging was used to track if battery hull is sealed Difficult to determine slow leak Upload relevant data online This provide historical data for operator to reference easily without unsealing the hull Can be useful for leak Or to track degredation of battery Or to track if cells are becoming unbalanced All of which should be rectified to ensure that AUV battery can function properly Few Option MCU with Wireless Capability Not suitable for Metal hull Accompanying PCB for BCB Same connector used to charge also hold the CAN Lines Able to connect CAN Line to the PCB to retrieve data from the BCB BCB would then be able to upload the data online Chose the BCB option as we dont need the PMB to have access to the internet all the time. This is as when it is turned on, it is sually connected to the AUV or the BCB. When it is connected to AUV it would have access to the Internet Insert diagram from interim report While BCB means we need extra component, it is worth while as we can implement additional features (mentioned in section xxx) we can use it Especially since the PMB will be on only when conencted to AUV or BCB Go through BCB PCB design Powered with USB-C allow to power with the Charger itself (no need extra plug) Have ESP32 to get the CAN stuff and publish online with ESP capability Insert CAN Table Talk about how it receive the CAN messages and use the Google App Script to Publish into its relevant scripts Test Simulated with Serial Communication with the computer Chose google sheet instead of database as it is easy for all members to use and track. Can even use on phone. current time obtained from NTP Can say that previously there was plan for local logging -\u003e included in te design of the PMB As the data would be uploaded online by either the AUV or the BCB, there isnt really a need Accessing the local data is more troublesome as you have to unseal the hull. To ensure data accuracy there is a timeut for the stats If any stats dont come within 2x its reporting frequency the data is cleared and not reported to prevent posting outdated data Use a table to compare what is shown on the screen, what is reported to telegram and what is sent to google sheet Explain the differences (difference in purpose) Improving Reliability and Safety Automatic Fault Detection Alert\nBuild on what was mentioned in the pervious section Based on experience with ASV Tele Channel Know that it is good Telegram channel is commonly used by members so low barrier of entry Allow to alert multiple people higher chance of someone noticing The Google App Script when it uploads also check If the Pressure below 107 report immediately on Telegram Check with previous P/T to see if there is a significant drop -\u003e likely leak -\u003e will also alert member Insert scatter plot of Pressure and Temperature measurement Show telegram screenshot when leak might be detected Also able to alert user that the battery is charged Also good reminder to members that the battery is being charged since they would be receving messages (will remind them to turn off charger) Battery Protection\nUsed BQ40Z50 protection Protects against possible electrical fault -\u003e increase system robustness Include literature review of hardware vs software safety Tested with COV, OC Tested both hardware and software limit Insert data and photo and excel also tested CUVC such that when the battery voltage is low and there is high current draw it will cut to protect the battery (to decide if I want to include this) explain that connector limit is 40A (insert reference to SubConn) While we have fuse, it is also good to have additional layer of protection also has a short circuit protection protect battery and auv from further harm Go through PMB Design (good practses to increase reliability)\nLook at OneNote on PCB explanation Power Rating Show the load test show temperature picture Pool test show that it is around 11A per battery when moving at full spped To be safe, the test was done at 40A because it was the connector rating (include time spent running) Insert calculation for designs in appendix (refer to OneNote) Talk about the Current Draw and Oz of outer layer as well as trace width Show that it is 4 layer with split plane for the different Power Refer the SLUA on how to route Talk about the difference and similarity to SLUAA reccomendation Isolation Protection and noise especially for battery Look at Altium to see what each section does and how it ties to the design Go through mistakes that was in the PCB and list the possible improvement also Design for easy debugging Test Points Extra conector to test CAN Transmissions Switches to switch communication line Take a photo of PMB and highlight all the connections to show all the output and what it is connected to Power Consumption chart to spec the different voltage regulator Current draw of MCU and screen is 40mA System Evaluation and Impact Evaluation\nBasic Feature Refer to earlier table to see if able to meet all the requirements Able to be backward compatible -\u003e can fit into old battery hull, can be turned on with reed switch, can charge, can discharge Able to report telemetry, able to draw, able to charge Verified reporting is accurate -\u003e Voltage measured with multimeter Current is calibrated with a load tester drawing a constant load Discharging and Charging State of Battery Verified Improvements (use a before: after table) Run Time: Increased User Operability and Maintenace: 25 mins to 5mins to upload, constant logging Reliability -\u003e able to detect leak immediately Have another table that compares old PMB and New PMB Interfaces Data Reporting Ease of use etc. Mistakes No Pull Down for Isolator Signal No pull up for I2C Impact\nTo be deployed at RoboSub 2025 PCB Designed will be released to help other teams design their own PMB Internet connected BCB was not seen at RoboSub, with teams moving towards battery pods, this is something that can be useful for them Future Work Test with the AUV Unable to do so due to limited hull and pool test Did not want to open and swap out the PMB as the hulls are old and notoriously hard to seal Was waiting for development of new hull to put the new pmb in Merge BCB into a Smart Charger Communciate with PMB to negoitate desired current and voltage Can get data directly from the charger also Better User Operability Using same connector for Balance Pin and Flashing works for previous PMB as it is connected to each other Does not work as thsi fried everything Future Work Change connector to something different so you dont accidentally misconnect More work and not interchangeable but its just crimp 1x so its not too bad should ahve integrated protection into the line clamping diode to prevent over 3v3 diode to prevent reverse polarity Conclusion Move from Power Monitoring to Power Management Well Integrated system to deliver xxxx AUV for RoboSub References Appendix PCB Schematic and Routing Calculations Look at OneNote on PCB explanation BQStudio Configuration (Insert Link to the Page) ",
  "wordCount" : "2549",
  "inLanguage": "en",
  "datePublished": "2025-04-03T00:00:00Z",
  "dateModified": "2025-04-04T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "Teoh Xu En"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/website/report/final_report/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "AUV Battery Management System",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/website/favicon.ico"
    }
  }
}
</script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"
  onload="renderMathInElement(document.body);"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: "\\begin{equation}", right: "\\end{equation}", display: true},
            {left: "\\begin{equation*}", right: "\\end{equation*}", display: true},
            {left: "\\begin{align}", right: "\\end{align}", display: true},
            {left: "\\begin{align*}", right: "\\end{align*}", display: true},
            {left: "\\begin{alignat}", right: "\\end{alignat}", display: true},
            {left: "\\begin{gather}", right: "\\end{gather}", display: true},
            {left: "\\begin{CD}", right: "\\end{CD}", display: true},
          ],
          throwOnError : false
        });
    });
</script>
 


</head>

<body class="" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/website/" accesskey="h" title="Battery Management System">
                <img src="http://localhost:1313/website/favicon.ico" alt="" aria-label="logo"
                    height="18"
                    width="18">Battery Management System</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/website/report/" title="Report">
                    <span>Report</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/website/guides/" title="Guides">
                    <span>Guides</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/website/configurations/" title="Configurations">
                    <span>Configurations</span>
                </a>
            </li>
        </ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Development of A Battery Management System for AUV4.5
    </h1>
    <div class="post-meta"><span title='2025-04-03 00:00:00 +0000 UTC'>April 2025</span>&nbsp;&middot;&nbsp;Teoh Xu En&nbsp;&middot;&nbsp;<a href="https://bumblebee.sg/" rel="noopener noreferrer" target="_blank">Team Website</a>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#acknowledgement">Acknowledgement</a></li>
    <li><a href="#list-of-common-acronyms">List of Common Acronyms</a></li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#problem-background">Problem Background</a></li>
    <li><a href="#project-goal">Project Goal</a></li>
    <li><a href="#design-considerations">Design Considerations</a></li>
    <li><a href="#system-design">System Design</a></li>
    <li><a href="#improve-user-operability-and-workflow">Improve User Operability and Workflow</a></li>
    <li><a href="#improving-reliability-and-safety">Improving Reliability and Safety</a></li>
    <li><a href="#system-evaluation-and-impact">System Evaluation and Impact</a></li>
    <li><a href="#future-work">Future Work</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
    <li><a href="#appendix">Appendix</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="acknowledgement">Acknowledgement<a hidden class="anchor" aria-hidden="true" href="#acknowledgement">#</a></h2>
<ul>
<li>Bumblebee Team, especially Elec Team to bounce idea with</li>
<li>Zi Yang and Tan Chern Lin for providing feedback, Chen Jia Wei for troubleshooting. Marvin for giving the idea.</li>
<li>Guk Yi Siong for helping in obtaining power consumption data</li>
<li>Ananyan for  validating my mechanical ideas</li>
<li>Ms Annie, Patrick, KK, Graham</li>
<li>Parker Schless from Cornell AUV for his advice when I faced problems</li>
<li>Eugene for taking time to review the project and providing advice</li>
<li>School for providing the lab, lab equipment and resources</li>
<li>sponsors for helping the team also</li>
</ul>
<hr>
<h2 id="list-of-common-acronyms">List of Common Acronyms<a hidden class="anchor" aria-hidden="true" href="#list-of-common-acronyms">#</a></h2>
<p>TODO:</p>
<hr>
<h2 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h2>
<p>TODO:</p>
<hr>
<h2 id="problem-background">Problem Background<a hidden class="anchor" aria-hidden="true" href="#problem-background">#</a></h2>
<ul>
<li>
<p>Introduction</p>
<ul>
<li>Student Project TEam that develops AUV for RoboSub.</li>
<li>Previously sent AUV4.1 for RoboSub 2024 and is developing AUV4.5 for RoboSub 2025 and AUV 5.0 for RoboSub 2025
<ul>
<li>Insert Table and timeline of the different AUV</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Problem Context</p>
<ul>
<li>
<p>Background</p>
<ul>
<li>Battery Management System comprises of
<ul>
<li>Battery Hull -&gt; PMB, Battery and Battery Hull</li>
<li>Battery Charging Box -&gt; Charger</li>
</ul>
</li>
<li>Designed such that the batteries are in its own waterproof hull so that it is easy to change battery at pool test</li>
<li>BCB is designed to support the current system by adapting the connectors to the charger</li>
<li>PMB is used to turn on and off the batter and report its voltage and current on the CAN Bus.</li>
</ul>
</li>
<li>
<p>Current Challenges</p>
<ul>
<li>Difficult to seal
<ul>
<li>Increase down time</li>
<li>Bad user operation</li>
</ul>
</li>
<li>Limited Capabilities of Battery Fuel Gauge
<ul>
<li>Poor Fuel Guaging (lack there off)
<ul>
<li>Reduce Run time</li>
</ul>
</li>
<li>No Protection (It just monitors the voltage and current)
<ul>
<li>Reduce Reliability</li>
</ul>
</li>
</ul>
</li>
<li>No systematic monitoring of leak
<ul>
<li>Poor User Operation</li>
<li>Unreliable</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Analysis of Problems</p>
<ul>
<li>Bad user operation -&gt; prone to mistakes at competition can cause reliability issue at competition</li>
<li>Increase down time and Reduce run time -&gt; less testing can be done
<ul>
<li>Give example of current situation</li>
<li>only 1 set of functional battery -&gt; means test for 1h45 mins</li>
<li>1255 to 1415 Charging -&gt; 1h20mins of charging</li>
<li>Increase run time huge priority</li>
</ul>
</li>
<li>Table of Testing Time -&gt; compared to RobotX Result (get from interim presentation)</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="project-goal">Project Goal<a hidden class="anchor" aria-hidden="true" href="#project-goal">#</a></h2>
<p>As a competition team, the primary objective of our vehicle is to perform well at its competition (RoboSub). This can be attained by reducing the vehicle’s down time and ensuring a safe, systematic operations</p>
<p>Refer to the Analysis of Problem</p>
<p>Project Goal:
To develop a battery management systems that improves runtime, user operability and safety to enhance the AUV&rsquo;s reliability and performance.</p>
<hr>
<h2 id="design-considerations">Design Considerations<a hidden class="anchor" aria-hidden="true" href="#design-considerations">#</a></h2>
<ul>
<li>Design Specification
<ul>
<li>Need to fit in the same hull (Backward Compatibility)
<ul>
<li>PMB size constraints</li>
<li>Have to use the same connector and pins</li>
<li>Becasue we deploying AUV4.5</li>
<li>Minimal modification allow for easy swap (get to work with new and old PMB)</li>
<li>Streamline spare prep and lower cost by leveraging Economies of Scale</li>
</ul>
</li>
<li>Basic Criteria (can be presented in a table)
<ul>
<li>Able to power 40A continuous</li>
<li>Can spike X A</li>
<li>Able to communicate with rest of AUV</li>
<li>Same Interface
<ul>
<li>Reed Switch to turn on and off</li>
<li>Able to display key stats on screen</li>
</ul>
</li>
</ul>
</li>
<li>Ease of Production and Spares (competition experience)
<ul>
<li>Less stuff to pack</li>
<li>MCU, CAN Chip etc are standardised.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="system-design">System Design<a hidden class="anchor" aria-hidden="true" href="#system-design">#</a></h2>
<p>Provide a bigger picture first.
Summary of the system design, will go into details below how everything work etc. (how the design of the PMB and BCB PCB can help to fulfil the project goal while meeting design considerations)</p>
<ul>
<li>
<p>2x PMB Architecture -&gt; surrounded by dotted lines</p>
<ul>
<li>Architecture should reference the PMB along with the different subsystem and external components</li>
<li>Talk about the differnt Power and Grounds</li>
<li>One is when connected in BCB
<ul>
<li>Show how the power goes to charger</li>
<li>CAN goes to PMB board</li>
<li>PMB board powerd by USB-C</li>
<li>Using Balance connector for programming pin</li>
<li>Data Flow
<ul>
<li>PMB -&gt; CAN Bus -&gt; ESP32 -&gt; Telegram Bot -&gt; Google App Script</li>
</ul>
</li>
</ul>
</li>
<li>One is when connected to AUV
<ul>
<li>Show that it communicate with CAN to AUV</li>
<li>Power with connector</li>
</ul>
</li>
<li>Data Flow
<ul>
<li>PMB -&gt; CAN Bus -&gt; SBC-CAN -&gt; Serial -&gt; SBC -&gt; Ethernet to Router -&gt; Data Uploaded Online</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Using SystemPres, Relay and Reed Switch to turn on the vehicle</p>
<ul>
<li>Turn on is via reed switch activiating a relay</li>
<li>Turn off is MCU detect reed switch and activate a signal
<ul>
<li>Allows MCU to do whatever it needds to do before pwoering off.</li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- - Overall System Architecture
  - How is everythinkg linked together
    - Architecture Diagram
  - Say which thing can solve what
- Mention that alternatives were discussed below
- Create table of need to be done,must have etc -->
<hr>
<h3 id="increase-run-time">Increase Run Time<a hidden class="anchor" aria-hidden="true" href="#increase-run-time">#</a></h3>
<ul>
<li>
<p>Insert description on why we want to increase run time and how to do it</p>
</li>
<li>
<p>Battery Upgrade</p>
<ul>
<li>Current Battery is 2 years old where with regular discharge</li>
<li>Insert data on battery degradation over time</li>
<li>We need 6 batteries for each AUV especially with the 2x AUV</li>
<li>Need procure new cost effective batteries</li>
<li>Shortlisted 3x Batteries
<ul>
<li>Same Voltage and Dimensions to fit in the hull and to be backward compatible</li>
<li>Power per dollar comparison</li>
</ul>
</li>
<li>Li-Ion chosen for the higher capacity ina smaller form factor</li>
<li>Purchase 2x Raitan Battery for test
<ul>
<li>Insert table to compare the 2x battery runtime as well as dimensions comparison with weight
<ul>
<li>2.4kg for 2 LiIon Battery, 2.5kg for 2 LiPo battery</li>
<li>Old: 188 x 75 x 42, New: 171 x 78 x 44</li>
</ul>
</li>
<li>Insert photo of the battery in the hull</li>
<li>Compare Power Drain between old and new battery</li>
</ul>
</li>
<li>Shown that the Raitan battery is a worthy replacement</li>
<li>The Molicell Chemistry is available by TI -&gt; help make the learning process easier (check if the other chemistry have or not)</li>
</ul>
</li>
<li>
<p>Accurate SoC Estimation</p>
<ul>
<li>Previously was using the gauging chip without using the learning algorithm</li>
<li>Means rely on voltage only
<ul>
<li>Inaccurate -&gt; insert voltage to capacity graph to explain why is it difficult to stop based on voltage</li>
</ul>
</li>
<li>By changing the chip we can implement RSOC tracking
<ul>
<li>Allow us to stop at a more accurate time
<ul>
<li>More time to draw</li>
</ul>
</li>
</ul>
</li>
<li>Say we do research found 2 other teams with battery gauging
<ul>
<li>OSU and Cornell -&gt; one is using BQ40Z50 the other is using BQ40Z80 (double check the name)</li>
<li>Showed that it is utilised by teams with good results
<ul>
<li>Insert replies by Cornell on good review</li>
</ul>
</li>
<li>Standalone with protection, gauging feaure</li>
<li>Software to allow for easy configuration of data flash and registers
<ul>
<li>Insert Photo of BQ Studio Interface</li>
</ul>
</li>
<li>Lots of support from TI (forum)</li>
<li>Maybe can put a literature review portion to explain how the Impedance Tracking work and how the learning process works</li>
</ul>
</li>
<li>Chose BQ40Z50 as it has a more accurate tracking
<ul>
<li>Insert comparison table with older chip
<ul>
<li>Able to support 4S</li>
<li>Lots of support online</li>
</ul>
</li>
<li>Based on battery chemistry + learning to study</li>
<li>Insert power draw time difference
<ul>
<li>If using RSOC give us extra 20mins as compared to if we relied on voltage only</li>
</ul>
</li>
<li>Look at their predicted charging and draw time, then compare how accurate it is
<ul>
<li>Charging (Case 1)
<ul>
<li>8:20pm, predcited 70 minutes. Battery: 16.42V RSOC 84%, charging at 4A</li>
<li>completed at 9.10pm. Battery: 16.84V, RSOC 100%. Finished 20mins faster than expected</li>
</ul>
</li>
<li>Charging (Case 2)
<ul>
<li>1.07 AM, 128 Minutes left, battery at 65% and 15.76 V</li>
<li>2.41 AM, charging completed. Finished 30mins faster than expected</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="improve-user-operability-and-workflow">Improve User Operability and Workflow<a hidden class="anchor" aria-hidden="true" href="#improve-user-operability-and-workflow">#</a></h2>
<ul>
<li>
<p>Aim to make it easier for memerbs to oeprate and maintain vehicle to keep vehcile reliable despite long operation hours. Main goal is to reduce down time but icnreasing reliability. Help to prevent damage to battery hulls or vehicle. Prevent taking people away from development by fixing damges.</p>
</li>
<li>
<p>In-Hull Firmware Flashing</p>
<ul>
<li>Allows for flashing and update without opening hull
<ul>
<li>Reduces error during reseasling, reduces downtime</li>
<li>Tested during RobotX 2024 where a USB port was exposed on the ASV to allow for firmware flashing</li>
</ul>
</li>
<li>Few Option
<ul>
<li>CAN Bus Flashing to allow for flashing via CAN
<ul>
<li>Require higher overhead as you need a more expensive microcontroller</li>
<li>Need build own bootloader</li>
<li>Show old connector where CAN is alreaday exposed</li>
</ul>
</li>
<li>Use the original Balance Connector
<ul>
<li>Explain that with the BQ40Z50 chip, balancing can be done with the chip, so balancing dont have to use charger to balance.
<ul>
<li>Frees up the connector</li>
</ul>
</li>
<li>Reduce changes needed to be done</li>
<li>Allows to expose the BQ chip comms also</li>
</ul>
</li>
</ul>
</li>
<li>Insert image of old balance connector vs new balance connector</li>
</ul>
</li>
<li>
<p>Remote Status Monitoring</p>
<ul>
<li>AS mentioned in xxx manual logging was used to track if battery hull is sealed</li>
<li>Difficult to determine slow leak</li>
<li>Upload relevant data online</li>
<li>This provide historical data for operator to reference easily without unsealing the hull
<ul>
<li>Can be useful for leak</li>
<li>Or to track degredation of battery</li>
<li>Or to track if cells are becoming unbalanced
<ul>
<li>All of which should be rectified to ensure that AUV battery can function properly</li>
</ul>
</li>
</ul>
</li>
<li>Few Option
<ul>
<li>MCU with Wireless Capability
<ul>
<li>Not suitable for Metal hull</li>
</ul>
</li>
<li>Accompanying PCB for BCB
<ul>
<li>Same connector used to charge also hold the CAN Lines</li>
<li>Able to connect CAN Line to the PCB to retrieve data from the BCB</li>
<li>BCB would then be able to upload the data online</li>
</ul>
</li>
<li>Chose the BCB option as we dont need the PMB to have access to the internet all the time. This is as when it is turned on, it is sually connected to the AUV or the BCB. When it is connected to AUV it would have access to the Internet
<ul>
<li>Insert diagram from interim report</li>
</ul>
</li>
</ul>
</li>
<li>While BCB means we need extra component, it is worth while as we can implement additional features (mentioned in section xxx) we can use it</li>
<li>Especially since the PMB will be on only when conencted to AUV or BCB</li>
<li>Go through BCB PCB design
<ul>
<li>Powered with USB-C allow to power with the Charger itself (no need extra plug)</li>
<li>Have ESP32 to get the CAN stuff and publish online with ESP capability
<ul>
<li>Insert CAN Table</li>
<li><img loading="lazy" src="image.png" alt="CAN Table"  />
</li>
</ul>
</li>
<li>Talk about how it receive the CAN messages and use the Google App Script to Publish into its relevant scripts</li>
<li>Test
<ul>
<li>Simulated with Serial Communication with the computer</li>
</ul>
</li>
<li>Chose google sheet instead of database as it is easy for all members to use and track. Can even use on phone.</li>
</ul>
</li>
<li>current time obtained from NTP</li>
<li>Can say that previously there was plan for local logging -&gt; included in te design of the PMB
<ul>
<li>As the data would be uploaded online by either the AUV or the BCB, there isnt really a need</li>
<li>Accessing the local data is more troublesome as you have to unseal the hull.</li>
</ul>
</li>
<li>To ensure data accuracy there is a timeut for the stats
<ul>
<li>If any stats dont come within 2x its reporting frequency the data is cleared and not reported to prevent posting outdated data</li>
</ul>
</li>
<li>Use a table to compare what is shown on the screen, what is reported to telegram and what is sent to google sheet</li>
<li>Explain the differences (difference in purpose)</li>
</ul>
</li>
</ul>
<hr>
<h2 id="improving-reliability-and-safety">Improving Reliability and Safety<a hidden class="anchor" aria-hidden="true" href="#improving-reliability-and-safety">#</a></h2>
<ul>
<li>
<p>Automatic Fault Detection Alert</p>
<ul>
<li>Build on what was mentioned in the pervious section</li>
<li>Based on experience with ASV Tele Channel
<ul>
<li>Know that it is good</li>
<li>Telegram channel is commonly used by members so low barrier of entry</li>
<li>Allow to alert multiple people higher chance of someone noticing</li>
</ul>
</li>
<li>The Google App Script when it uploads also check
<ul>
<li>If the Pressure below 107 report immediately on Telegram</li>
<li>Check with previous P/T to see if there is a significant drop -&gt; likely leak -&gt; will also alert member</li>
<li>Insert scatter plot of Pressure and Temperature measurement</li>
</ul>
</li>
<li>Show telegram screenshot when leak might be detected</li>
<li>Also able to alert user that the battery is charged</li>
<li>Also good reminder to members that the battery is being charged since they would be receving messages (will remind them to turn off charger)</li>
</ul>
</li>
<li>
<p>Battery Protection</p>
<ul>
<li>Used BQ40Z50 protection</li>
<li>Protects against possible electrical fault -&gt; increase system robustness</li>
<li>Include literature review of hardware vs software safety</li>
<li>Tested with COV, OC
<ul>
<li>Tested both hardware and software limit
<ul>
<li>Insert data and photo and excel</li>
</ul>
</li>
<li>also tested CUVC such that when the battery voltage is low and there is high current draw it will cut to protect the battery (to decide if I want to include this)</li>
<li>explain that connector limit is 40A (insert reference to SubConn)</li>
<li>While we have fuse, it is also good to have additional layer of protection</li>
<li>also has a short circuit protection</li>
</ul>
</li>
<li>protect battery and auv from further harm</li>
</ul>
</li>
<li>
<p>Go through PMB Design (good practses to increase reliability)</p>
<ul>
<li>Look at OneNote on PCB explanation</li>
<li>Power Rating
<ul>
<li>Show the load test</li>
<li>show temperature picture</li>
<li>Pool test show that it is around 11A per battery when moving at full spped</li>
<li>To be safe, the test was done at 40A because it was the connector rating (include time spent running)</li>
<li>Insert calculation for designs in appendix (refer to OneNote)
<ul>
<li>Talk about the Current Draw and Oz of outer layer as well as trace width</li>
<li>Show that it is 4 layer with split plane for the different Power</li>
</ul>
</li>
<li>Refer the SLUA on how to route
<ul>
<li>Talk about the difference and similarity to SLUAA reccomendation</li>
</ul>
</li>
</ul>
</li>
<li>Isolation
<ul>
<li>Protection and noise especially for battery</li>
</ul>
</li>
<li>Look at Altium to see what each section does and how it ties to the design</li>
<li>Go through mistakes that was in the PCB
<ul>
<li>and list the possible improvement also</li>
</ul>
</li>
<li>Design for easy debugging
<ul>
<li>Test Points</li>
<li>Extra conector to test CAN Transmissions</li>
<li>Switches to switch communication line</li>
</ul>
</li>
<li>Take a photo of PMB and highlight all the connections to show all the output and what it is connected to</li>
<li>Power Consumption chart to spec the different voltage regulator</li>
<li>Current draw of MCU and screen is 40mA</li>
</ul>
</li>
</ul>
<hr>
<h2 id="system-evaluation-and-impact">System Evaluation and Impact<a hidden class="anchor" aria-hidden="true" href="#system-evaluation-and-impact">#</a></h2>
<ul>
<li>
<p>Evaluation</p>
<ul>
<li>Basic Feature
<ul>
<li>Refer to earlier table to see if able to meet all the requirements</li>
<li>Able to be backward compatible -&gt; can fit into old battery hull, can be turned on with reed switch, can charge, can discharge</li>
<li>Able to report telemetry, able to draw, able to charge
<ul>
<li>Verified reporting is accurate -&gt; Voltage measured with multimeter</li>
<li>Current is calibrated with a load tester drawing a constant load</li>
<li>Discharging and Charging State of Battery Verified</li>
</ul>
</li>
</ul>
</li>
<li>Improvements (use a before: after table)
<ul>
<li>Run Time: Increased</li>
<li>User Operability and Maintenace: 25 mins to 5mins to upload, constant logging</li>
<li>Reliability -&gt; able to detect leak immediately</li>
<li>Have another table that compares old PMB and New PMB
<ul>
<li>Interfaces</li>
<li>Data Reporting</li>
<li>Ease of use etc.</li>
</ul>
</li>
</ul>
</li>
<li>Mistakes
<ul>
<li>No Pull Down for Isolator Signal</li>
<li>No pull up for I2C</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Impact</p>
<ul>
<li>To be deployed at RoboSub 2025</li>
<li>PCB Designed will be released to help other teams design their own PMB</li>
<li>Internet connected BCB was not seen at RoboSub, with teams moving towards battery pods, this is something that can be useful for them</li>
</ul>
</li>
</ul>
<hr>
<h2 id="future-work">Future Work<a hidden class="anchor" aria-hidden="true" href="#future-work">#</a></h2>
<ul>
<li>Test with the AUV
<ul>
<li>Unable to do so due to limited hull and pool test</li>
<li>Did not want to open and swap out the PMB as the hulls are old and notoriously hard to seal</li>
<li>Was waiting for development of new hull to put the new pmb in</li>
</ul>
</li>
<li>Merge BCB into a Smart Charger
<ul>
<li>Communciate with PMB to negoitate desired current and voltage</li>
<li>Can get data directly from the charger also</li>
</ul>
</li>
<li>Better User Operability
<ul>
<li>Using same connector for Balance Pin and Flashing
<ul>
<li>works for previous PMB as it is connected to each other</li>
<li>Does not work as thsi fried everything</li>
<li>Future Work
<ul>
<li>Change connector to something different so you dont accidentally misconnect</li>
<li>More work and not interchangeable but its just crimp 1x so its not too bad</li>
</ul>
</li>
<li>should ahve integrated protection into the line
<ul>
<li>clamping diode to prevent over 3v3</li>
<li>diode to prevent reverse polarity</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<ul>
<li>Move from Power Monitoring to Power Management</li>
<li>Well Integrated system to deliver xxxx AUV for RoboSub</li>
</ul>
<hr>
<h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<hr>
<h2 id="appendix">Appendix<a hidden class="anchor" aria-hidden="true" href="#appendix">#</a></h2>
<ul>
<li>PCB Schematic and Routing</li>
<li>Calculations
<ul>
<li>Look at OneNote on PCB explanation</li>
</ul>
</li>
<li>BQStudio Configuration (Insert Link to the Page)</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="http://localhost:1313/website/">AUV Battery Management System</a></span> ·     
    <span>
    Powered by 
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/pmichaillat/hugo-website/" rel="noopener" target="_blank">a modified version</a>
         of 
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>
</html>
